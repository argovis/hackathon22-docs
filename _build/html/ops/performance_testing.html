

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Performance Testing &mdash; argovis  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Point Schema" href="../data_management/point_schema.html" />
    <link rel="prev" title="Argovis Kubernetes Deployment" href="deployment.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> argovis
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/set_up_dev_environment.html">Setting Up Argovis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/api_development.html">API Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/custom_angular_components.html">Creating Custom Angular Components</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Operations Playbooks</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="deployment.html">Argovis Kubernetes Deployment</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Performance Testing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#load-testing">Load Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="#database-response-testing">Database Response Testing</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Data Management</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../data_management/point_schema.html">Point Schema</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data_management/argo_merge.html">Merging Argo Data</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer Tools &amp; Techniques</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../dev_tools/fast_development_builds.html">Fast Angular Builds</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev_tools/pull_requests_and_github.html">Pull Requests, Git &amp; GitHub</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev_tools/merge_conflicts.html">Dealing With Merge Conflicts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev_tools/using_branches.html">Using Branches</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Disaster Recovery</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../disaster_recovery/restore_a_mongo_collection.html">Restore Mongo from Backup</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Special Topics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../special_topics/connecting_to_the_container_network.html">Connecting to the Container Network</a></li>
<li class="toctree-l1"><a class="reference internal" href="../special_topics/goship-demo.html">Goship Demo Rebuild</a></li>
<li class="toctree-l1"><a class="reference internal" href="../special_topics/profiles-alpha.html">Profiles API Alpha Product</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">argovis</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Performance Testing</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/ops/performance_testing.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="performance-testing">
<span id="perftest"></span><h1>Performance Testing<a class="headerlink" href="#performance-testing" title="Permalink to this headline">¶</a></h1>
<p>In order to ensure Argovis scales to as many users as possible, and to give those users as good an experience as possible, Argovis undergoes performance testing to identify bottlenecks and measure viable load. This tutorial gives a high level overview of the tools and techniques available; refer to linked repos and docs for deeper dives.</p>
<div class="section" id="load-testing">
<h2>Load Testing<a class="headerlink" href="#load-testing" title="Permalink to this headline">¶</a></h2>
<p>Load testing scripts and resources are maintained in <a class="reference external" href="https://github.com/argovis/artillery">this repo</a>, and serve as our primary performance metric. As noted there, a key metric to track is median response time over time - this should be as stable as possible even for the heaviest endpoints, or else sustained load could degrade and crash the app. See the README in that repo for detailed config and run instructions.</p>
</div>
<div class="section" id="database-response-testing">
<h2>Database Response Testing<a class="headerlink" href="#database-response-testing" title="Permalink to this headline">¶</a></h2>
<p>In order to determine if mongodb is primarily responsible for slow responses from the API, we can use its built in profiler per the following. See <a class="reference external" href="https://docs.mongodb.com/manual/tutorial/manage-the-database-profiler/">the mongo docs</a> for more info.</p>
<ol class="arabic">
<li><p>Connect to a <code class="docutils literal notranslate"><span class="pre">mongo</span></code> shell in your running mongo container, using <code class="docutils literal notranslate"><span class="pre">oc</span> <span class="pre">exec</span></code>, <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">container</span> <span class="pre">exec</span></code>, or <code class="docutils literal notranslate"><span class="pre">kubectl</span> <span class="pre">exec</span></code> as appropriate for your environment.</p></li>
<li><p>Turn on mongo’s profiler. 100 ms is a reasonable cutoff for our purposes; actions slower than this will be logged:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>&gt; use argo
&gt; db.setProfilingLevel<span class="o">(</span><span class="m">1</span>, <span class="o">{</span> slowms: <span class="m">100</span> <span class="o">})</span>
</pre></div>
</div>
</li>
<li><p>Run some API requests, by hitting it manually or by running the Artillery scripts linked above.</p></li>
<li><p>Back in the mongo shell, check for events that took longer than 1000 ms (adjust to taste):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>&gt; db.system.profile.find<span class="o">(</span> <span class="o">{</span> millis : <span class="o">{</span> <span class="nv">$gt</span> : <span class="m">1000</span> <span class="o">}</span> <span class="o">}</span> <span class="o">)</span>.pretty<span class="o">()</span>
</pre></div>
</div>
<p>From here, you’ll have a list of the most expensive operations mongo is processing. See the <code class="docutils literal notranslate"><span class="pre">millis</span></code> key in the response documents for the length of time mongo spent on the operation; if this is a large or majority contribution to the response time of the API, consider scaling mongo or restricting the size of API calls allowed.</p>
</li>
<li><p>When done, make sure to turn off profiling in order to avoid impacting performance:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>&gt; db.setProfilingLevel<span class="o">(</span><span class="m">0</span><span class="o">)</span>
</pre></div>
</div>
</li>
</ol>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="../data_management/point_schema.html" class="btn btn-neutral float-right" title="Point Schema" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="deployment.html" class="btn btn-neutral float-left" title="Argovis Kubernetes Deployment" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Argovis Collaboration.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>